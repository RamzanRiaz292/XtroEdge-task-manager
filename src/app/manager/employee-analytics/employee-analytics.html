<div class="employee-analytics-container">
  <!-- Header -->
  <div class="header-bar">
    <div class="header-content">
      <h1><span class="header-icon">ğŸ“Š</span><span>Employee Analytics</span></h1>
      <div class="user-info">
        <span>Welcome, {{ user?.name }} (Manager)</span>
        <button (click)="logout()" class="btn btn-logout">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
            <polyline points="16 17 21 12 16 7" />
            <line x1="21" y1="12" x2="9" y2="12" />
          </svg>
          Logout</button>
      </div>
    </div>
  </div>

  <!-- Quick Stats Overview -->
  <div class="overview-section">
    <h2><span class="section-icon">ğŸ“ˆ</span><span>Quick Employee Overview</span></h2>
    <div class="overview-stats">
      <div class="overview-card">
        <div class="overview-icon"><span>ğŸ‘¥</span></div>
        <div class="overview-info">
          <h3>Total Employees</h3>
          <span class="overview-number">{{ totalEmployees }}</span>
        </div>
      </div>
      <div class="overview-card">
        <div class="overview-icon"><span>âœ…</span></div>
        <div class="overview-info">
          <h3>Avg Completion Rate</h3>
          <span class="overview-number">{{ avgCompletionRate }}%</span>
        </div>
      </div>
      <div class="overview-card">
        <div class="overview-icon"><span>ğŸ“‹</span></div>
        <div class="overview-info">
          <h3>Total Tasks Assigned</h3>
          <span class="overview-number">{{ totalTasksAssigned }}</span>
        </div>
      </div>
      <div class="overview-card">
        <div class="overview-icon"><span>â°</span></div>
        <div class="overview-info">
          <h3>Overdue Tasks</h3>
          <span class="overview-number">{{ totalOverdueTasks }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Employees Grid -->
  <div class="employees-grid-section">
    <h2><span class="section-icon">ğŸ‘¨â€ğŸ’¼</span><span>All Employees Performance</span></h2>
    
    <div *ngIf="employeeStats.length === 0 && !isLoading" class="empty-state">
      <p>No employees found. Add employees to see analytics.</p>
    </div>

    <div class="employees-grid">
      <div *ngFor="let stat of employeeStats" 
           class="employee-card"
           (click)="viewEmployeeDetails(stat)">
        
        <div class="employee-header">
          <div class="employee-avatar">
            <span>{{ stat.employee.name.charAt(0).toUpperCase() }}</span>
          </div>
          <div class="employee-basic-info">
            <h4>{{ stat.employee.name }}</h4>
            <p class="employee-email">{{ stat.employee.email }}</p>
          </div>
          <div class="completion-rate">
            <div class="progress-circle" [style.background]="'conic-gradient(#28a745 ' + stat.completionRate + '%, #e9ecef 0)'">
              <span class="progress-text">{{ stat.completionRate.toFixed(0) }}%</span>
            </div>
          </div>
        </div>

        <div class="employee-stats">
          <div class="stat-row">
            <div class="stat-item">
              <span class="stat-label">Total Tasks</span>
              <span class="stat-value">{{ stat.totalTasks }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Completed</span>
              <span class="stat-value completed">{{ stat.completedTasks }}</span>
            </div>
          </div>
          <div class="stat-row">
            <div class="stat-item">
              <span class="stat-label">In Progress</span>
              <span class="stat-value in-progress">{{ stat.inProgressTasks }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Pending</span>
              <span class="stat-value pending">{{ stat.pendingTasks }}</span>
            </div>
          </div>
        </div>

        <div class="employee-period-stats">
          <div class="period-item">
            <span class="period-label">Today</span>
            <span class="period-value">{{ stat.tasksByPeriod.today }}</span>
          </div>
          <div class="period-item">
            <span class="period-label">This Week</span>
            <span class="period-value">{{ stat.tasksByPeriod.thisWeek }}</span>
          </div>
          <div class="period-item">
            <span class="period-label">This Month</span>
            <span class="period-value">{{ stat.tasksByPeriod.thisMonth }}</span>
          </div>
        </div>

        <div class="view-details-btn">
          <button class="btn btn-outline btn-sm" 
                  (click)="viewEmployeeDetails(stat, $event)">
            <span>View Details â†’</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Employee Details Modal -->
  <div *ngIf="selectedEmployee" class="modal-overlay" (click)="closeEmployeeDetails($event)">
    <div class="modal employee-details-modal" (click)="onModalClick($event)">
      <div class="modal-header">
        <h3><span class="modal-icon">ğŸ“Š</span><span>{{ selectedEmployee.employee.name }} - Performance Details</span></h3>
        <button class="close-btn" (click)="closeEmployeeDetails($event)"><span>Ã—</span></button>
      </div>

      <div class="modal-body">
        <!-- Employee Basic Info -->
        <div class="employee-profile">
          <div class="profile-avatar">
            <span>{{ selectedEmployee.employee.name.charAt(0).toUpperCase() }}</span>
          </div>
          <div class="profile-info">
            <h4>{{ selectedEmployee.employee.name }}</h4>
            <p class="profile-email">{{ selectedEmployee.employee.email }}</p>
            <p class="profile-join-date">
              <span>Joined: {{ formatDate(selectedEmployee.employee.created_at) }}</span>
            </p>
          </div>
        </div>

        <!-- Overall Statistics -->
        <div class="stats-section">
          <h4><span class="section-icon">ğŸ“ˆ</span><span>Overall Performance</span></h4>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon"><span>ğŸ“‹</span></div>
              <div class="stat-info">
                <h5>Total Tasks</h5>
                <span class="stat-number">{{ selectedEmployee.totalTasks }}</span>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><span>âœ…</span></div>
              <div class="stat-info">
                <h5>Completed</h5>
                <span class="stat-number">{{ selectedEmployee.completedTasks }}</span>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><span>ğŸ”„</span></div>
              <div class="stat-info">
                <h5>In Progress</h5>
                <span class="stat-number">{{ selectedEmployee.inProgressTasks }}</span>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><span>â°</span></div>
              <div class="stat-info">
                <h5>Overdue</h5>
                <span class="stat-number">{{ selectedEmployee.overdueTasks }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Tasks by Period -->
        <div class="period-stats-section">
          <h4><span class="section-icon">ğŸ“…</span><span>Tasks by Time Period</span></h4>
          <div class="period-stats">
            <div class="period-stat-card">
              <div class="period-icon"><span>ğŸ•’</span></div>
              <div class="period-info">
                <h5>Lifetime</h5>
                <span class="period-number">{{ selectedEmployee.tasksByPeriod.lifetime }}</span>
              </div>
            </div>
            <div class="period-stat-card">
              <div class="period-icon"><span>ğŸ“…</span></div>
              <div class="period-info">
                <h5>This Month</h5>
                <span class="period-number">{{ selectedEmployee.tasksByPeriod.thisMonth }}</span>
              </div>
            </div>
            <div class="period-stat-card">
              <div class="period-icon"><span>ğŸ“†</span></div>
              <div class="period-info">
                <h5>This Week</h5>
                <span class="period-number">{{ selectedEmployee.tasksByPeriod.thisWeek }}</span>
              </div>
            </div>
            <div class="period-stat-card">
              <div class="period-icon"><span>ğŸ“</span></div>
              <div class="period-info">
                <h5>Today</h5>
                <span class="period-number">{{ selectedEmployee.tasksByPeriod.today }}</span>
              </div>
            </div>
            <div class="period-stat-card">
              <div class="period-icon"><span>ğŸ“š</span></div>
              <div class="period-info">
                <h5>Yesterday</h5>
                <span class="period-number">{{ selectedEmployee.tasksByPeriod.yesterday }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Tasks -->
        <div class="recent-tasks-section">
          <h4><span class="section-icon">ğŸ†•</span><span>Recent Tasks ({{ selectedEmployee.recentTasks.length }})</span></h4>
          <div class="recent-tasks">
            <div *ngFor="let task of selectedEmployee.recentTasks" class="recent-task-item">
              <div class="task-main">
                <h6 class="task-title">{{ task.title }}</h6>
                <p class="task-description">{{ task.description || 'No description' }}</p>
                <div class="task-meta">
                  <span class="task-date">Assigned: {{ formatDate(task.created_at) }}</span>
                  <span class="task-due">Due: {{ formatDate(task.due_date) }}</span>
                </div>
              </div>
              <div class="task-status">
                <span class="status-badge" [ngClass]="getStatusClass(task.status)">
                  {{ task.status.replace('_', ' ') }}
                </span>
                <span class="priority-badge" [ngClass]="getPriorityClass(task.priority)">
                  {{ task.priority }}
                </span>
              </div>
            </div>
          </div>
          
          <div *ngIf="selectedEmployee.recentTasks.length === 0" class="empty-tasks">
            <p>No recent tasks found.</p>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" 
                class="btn btn-secondary"
                (click)="closeEmployeeDetails($event)">
          <span>Close</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading employee analytics...</p>
  </div>
</div>